<div class="scenario-page-container">
  <!-- Header -->
  <div class="page-header">
    <h1>EnergetickÃ¡ akademie - NastavenÃ­</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        VÃ­tejte, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">OdhlÃ¡sit se</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>NaÄÃ­tÃ¡nÃ­ nastavenÃ­...</p>
  </div>

  <!-- Debug block removed -->

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="page-content">
    
    <!-- Scenario Selection -->
    <div class="scenario-controls-section">
      <h2>VÃ½bÄ›r scÃ©nÃ¡Å™e</h2>
      <div class="scenario-controls" *ngIf="scenarios.length > 0; else noScenarios">
        <select [value]="selectedScenario || ''" (change)="onScenarioChange($event)" class="scenario-select">
          <option value="" disabled>Vyberte scÃ©nÃ¡Å™...</option>
          <option *ngFor="let scenario of scenarios; trackBy: trackByScenario" [value]="scenario.id">
            {{ scenario.name }}
          </option>
        </select>
        <button 
          class="btn btn-start" 
          (click)="onStartGame()" 
          [disabled]="!selectedScenario || selectedScenario === '' || isGameLoading">
          {{ isGameLoading ? 'SpouÅ¡tÄ›nÃ­...' : 'Spustit hru' }}
        </button>
      </div>
      <ng-template #noScenarios>
        <p style="margin:0; color:#555;">Å½Ã¡dnÃ© scÃ©nÃ¡Å™e nejsou k dispozici nebo se nepodaÅ™ilo naÄÃ­st. Zkuste obnovit strÃ¡nku.</p>
      </ng-template>
    </div>

    <!-- Keyboard Shortcuts Information -->
    <div class="keyboard-shortcuts-section">
      <h2>OvlÃ¡dÃ¡nÃ­</h2>
      <div class="shortcuts-grid">
        <div class="shortcut-item">
          <span class="shortcut-key">Q</span>
          <span class="shortcut-description">UkonÄit hru (s potvrzenÃ­m)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">L</span>
          <span class="shortcut-description">OdhlÃ¡sit se (s potvrzenÃ­m)</span>
        </div>
        <div class="shortcut-item">2x
          <span class="shortcut-key">â†’</span>
          <span class="shortcut-description">DalÅ¡Ã­ slide</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">â†’</span>
          <span class="shortcut-description">DalÅ¡Ã­ hernÃ­ kolo</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">F</span>
          <span class="shortcut-description">PÅ™epnout fullscreen</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">ESC</span>
          <span class="shortcut-description">UkonÄit fullscreen</span>
        </div>
      </div>
      <p class="shortcuts-note">* Zkratky jsou aktivnÃ­ bÄ›hem hry a prezentace</p>

      Pro opuÅ¡tÄ›nÃ­ strÃ¡nky statistik staÄÃ­ dvakrÃ¡t stisknout klÃ¡vesu <span class="shortcut-key">ESC</span>
    </div>

    <!-- Team Status -->
    <div class="boards-section">
      <h2>Stav tÃ½mÅ¯</h2>
      <div class="boards-container setup-horizontal">
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)" [class.disconnected]="!isBoardConnected(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="connection-status">
                <span class="status-label">Stav:</span>
                <span class="status-value" [class.connected]="isBoardConnected(board)" [class.disconnected]="!isBoardConnected(board)">
                  {{ isBoardConnected(board) ? 'PÅ™ipojeno' : 'Odpojeno' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="boards-right">
          <div *ngFor="let board of getRightBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)" [class.disconnected]="!isBoardConnected(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="connection-status">
                <span class="status-label">Stav:</span>
                <span class="status-value" [class.connected]="isBoardConnected(board)" [class.disconnected]="!isBoardConnected(board)">
                  {{ isBoardConnected(board) ? 'PÅ™ipojeno' : 'Odpojeno' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Status -->
    <div *ngIf="gameStatus" class="game-status">
      <h2>ğŸ® Stav hry</h2>
      <p><strong>Stav:</strong> {{ gameStatus.game_active ? 'AktivnÃ­' : 'NeaktivnÃ­' }}</p>
      <p><strong>AktuÃ¡lnÃ­ kolo:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
      <p><strong>PÅ™ipojenÃ¡ zaÅ™Ã­zenÃ­:</strong> {{ connectedBoards.length }}</p>
      
      <!-- Show Statistics Button - appears when game has ended -->
      <div *ngIf="isGameFinished()" class="game-finished-actions">
        <p class="game-finished-message">ğŸ† Hra byla dokonÄena! Zobrazit vÃ½sledky a statistiky tÃ½mÅ¯.</p>
        <button 
          class="btn btn-statistics" 
          (click)="showGameStatistics()"
          [disabled]="isLoadingStatistics">
          {{ isLoadingStatistics ? 'NaÄÃ­tÃ¡nÃ­...' : 'ğŸ“Š Zobrazit statistiky' }}
        </button>
      </div>
    </div>

  </div>
</div>
