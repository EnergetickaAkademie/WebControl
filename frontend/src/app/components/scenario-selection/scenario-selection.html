<div class="scenario-page-container">
  <!-- Header -->
  <div class="page-header">
    <h1>Energetická akademie - Nastavení</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        Vítejte, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Odhlásit se</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Načítání nastavení...</p>
  </div>

  <!-- Debug block removed -->

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="page-content">
    
    <!-- Scenario Selection -->
    <div class="scenario-controls-section">
      <h2>Výběr scénáře</h2>
      <div class="scenario-controls" *ngIf="scenarios.length > 0; else noScenarios">
        <select [value]="selectedScenario || ''" (change)="onScenarioChange($event)" class="scenario-select">
          <option value="" disabled>Vyberte scénář...</option>
          <option *ngFor="let scenario of scenarios; trackBy: trackByScenario" [value]="scenario.id">
            {{ scenario.name }}
          </option>
        </select>
        <button 
          class="btn btn-start" 
          (click)="onStartGame()" 
          [disabled]="!selectedScenario || selectedScenario === '' || isGameLoading">
          {{ isGameLoading ? 'Spouštění...' : 'Spustit hru' }}
        </button>
      </div>
      <ng-template #noScenarios>
        <p style="margin:0; color:#555;">Žádné scénáře nejsou k dispozici nebo se nepodařilo načíst. Zkuste obnovit stránku.</p>
      </ng-template>
    </div>

    <!-- Keyboard Shortcuts Information -->
    <div class="keyboard-shortcuts-section">
      <h2>Ovládání</h2>
      <div class="shortcuts-grid">
        <div class="shortcut-item">
          <span class="shortcut-key">Q</span>
          <span class="shortcut-description">Ukončit hru (s potvrzením)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">L</span>
          <span class="shortcut-description">Odhlásit se (s potvrzením)</span>
        </div>
        <div class="shortcut-item">2x
          <span class="shortcut-key">→</span>
          <span class="shortcut-description">Další slide</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">→</span>
          <span class="shortcut-description">Další herní kolo</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">F</span>
          <span class="shortcut-description">Přepnout fullscreen</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">ESC</span>
          <span class="shortcut-description">Ukončit fullscreen</span>
        </div>
      </div>
      <p class="shortcuts-note">* Zkratky jsou aktivní během hry a prezentace</p>

      Pro opuštění stránky statistik stačí dvakrát stisknout klávesu <span class="shortcut-key">ESC</span>
    </div>

    <!-- Team Status -->
    <div class="boards-section">
      <h2>Stav týmů</h2>
      <div class="boards-container setup-horizontal">
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)" [class.disconnected]="!isBoardConnected(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="connection-status">
                <span class="status-label">Stav:</span>
                <span class="status-value" [class.connected]="isBoardConnected(board)" [class.disconnected]="!isBoardConnected(board)">
                  {{ isBoardConnected(board) ? 'Připojeno' : 'Odpojeno' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="boards-right">
          <div *ngFor="let board of getRightBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)" [class.disconnected]="!isBoardConnected(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="connection-status">
                <span class="status-label">Stav:</span>
                <span class="status-value" [class.connected]="isBoardConnected(board)" [class.disconnected]="!isBoardConnected(board)">
                  {{ isBoardConnected(board) ? 'Připojeno' : 'Odpojeno' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Status -->
    <div *ngIf="gameStatus" class="game-status">
      <h2>🎮 Stav hry</h2>
      <p><strong>Stav:</strong> {{ gameStatus.game_active ? 'Aktivní' : 'Neaktivní' }}</p>
      <p><strong>Aktuální kolo:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
      <p><strong>Připojená zařízení:</strong> {{ connectedBoards.length }}</p>
      
      <!-- Show Statistics Button - appears when game has ended -->
      <div *ngIf="isGameFinished()" class="game-finished-actions">
        <p class="game-finished-message">🏆 Hra byla dokončena! Zobrazit výsledky a statistiky týmů.</p>
        <button 
          class="btn btn-statistics" 
          (click)="showGameStatistics()"
          [disabled]="isLoadingStatistics">
          {{ isLoadingStatistics ? 'Načítání...' : '📊 Zobrazit statistiky' }}
        </button>
      </div>
    </div>

  </div>
</div>
