<div class="scenario-page-container">
  <!-- Header -->
  <div class="page-header">
    <h1>Energetick√° hra - Nastaven√≠ hry</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        V√≠tejte, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Odhl√°sit se</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Naƒç√≠t√°n√≠ nastaven√≠...</p>
  </div>

  <!-- Debug block removed -->

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="page-content">
    
    <!-- Scenario Selection -->
    <div class="scenario-controls-section">
      <h2>V√Ωbƒõr sc√©n√°≈ôe</h2>
      <div class="scenario-controls" *ngIf="scenarios.length > 0; else noScenarios">
        <select [value]="selectedScenario || ''" (change)="onScenarioChange($event)" class="scenario-select">
          <option value="" disabled>Vyberte sc√©n√°≈ô...</option>
          <option *ngFor="let scenario of scenarios; trackBy: trackByScenario" [value]="scenario.id">
            {{ scenario.name }}
          </option>
        </select>
        <button 
          class="btn btn-start" 
          (click)="onStartGame()" 
          [disabled]="!selectedScenario || selectedScenario === '' || isGameLoading">
          {{ isGameLoading ? 'Spou≈°tƒõn√≠...' : 'Spustit hru' }}
        </button>
      </div>
      <ng-template #noScenarios>
        <p style="margin:0; color:#555;">≈Ω√°dn√© sc√©n√°≈ôe nejsou k dispozici nebo se nepoda≈ôilo naƒç√≠st. Zkuste obnovit str√°nku.</p>
      </ng-template>
    </div>

    <!-- Keyboard Shortcuts Information -->
    <div class="keyboard-shortcuts-section">
      <h2>‚å®Ô∏è Kl√°vesov√© zkratky</h2>
      <div class="shortcuts-grid">
        <div class="shortcut-item">
          <span class="shortcut-key">Q</span>
          <span class="shortcut-description">Ukonƒçit hru (s potvrzen√≠m)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">L</span>
          <span class="shortcut-description">Odhl√°sit se (s potvrzen√≠m)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">‚Üí</span>
          <span class="shortcut-description">Dal≈°√≠ kolo (bƒõhem hry)</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">F</span>
          <span class="shortcut-description">P≈ôepnout celou obrazovku</span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-key">ESC</span>
          <span class="shortcut-description">Ukonƒçit celou obrazovku</span>
        </div>
      </div>
      <p class="shortcuts-note">* Zkratky jsou aktivn√≠ bƒõhem hry a prezentace</p>
    </div>

    <!-- Connected Boards -->
    <div class="boards-section">
      <h2>P≈ôipojen√© t√Ωmy</h2>
      <div class="boards-container setup-horizontal">
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>

        <div class="boards-right">
          <div *ngFor="let board of getRightBoards(); let i = index" class="board-card" [class.placeholder]="isBoardPlaceholder(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Status -->
    <div *ngIf="gameStatus" class="game-status">
      <h2>üéÆ Stav hry</h2>
      <p><strong>Stav:</strong> {{ gameStatus.game_active ? 'Aktivn√≠' : 'Neaktivn√≠' }}</p>
      <p><strong>Aktu√°ln√≠ kolo:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
      <p><strong>P≈ôipojen√° za≈ô√≠zen√≠:</strong> {{ connectedBoards.length }}</p>
      
      <!-- Show Statistics Button - appears when game has ended -->
      <div *ngIf="isGameFinished()" class="game-finished-actions">
        <p class="game-finished-message">üèÜ Hra byla dokonƒçena! Zobrazit v√Ωsledky a statistiky t√Ωm≈Ø.</p>
        <button 
          class="btn btn-statistics" 
          (click)="showGameStatistics()"
          [disabled]="isLoadingStatistics">
          {{ isLoadingStatistics ? 'Naƒç√≠t√°n√≠...' : 'üìä Zobrazit statistiky' }}
        </button>
      </div>
    </div>

  </div>
</div>
