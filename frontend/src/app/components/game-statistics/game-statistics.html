<div class="game-statistics-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <h2>Naƒç√≠t√°n√≠ statistik hry...</h2>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <h2>‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ statistik</h2>
    <p>{{ error }}</p>
    <button (click)="loadGameStatistics()" class="retry-button">Zkusit znovu</button>
  </div>

  <!-- Statistics Content -->
  <div *ngIf="!isLoading && !error && gameStatistics" class="statistics-content">
    <!-- Game Header -->
    <div class="game-header">
      <h1>üèÜ Hra dokonƒçena!</h1>
      
      <!-- Navigation Controls -->
      <div class="navigation-controls">
        <button class="nav-button" (click)="goBackToDashboard()" title="Zpƒõt na dashboard (‚Üí)">
          ‚Üê Zpƒõt na dashboard
        </button>
        <button class="nav-button" (click)="onContinue()" title="Pokraƒçovat do nastaven√≠">
          Pokraƒçovat do nastaven√≠ ‚Üí
        </button>
      </div>
      
      <div class="game-summary">
        <h2>Statistiky hry</h2>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="label">Sc√©n√°≈ô:</span>
            <span class="value">{{ gameStatistics.game_summary?.scenario_name || 'N/A' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Celkem kol:</span>
            <span class="value">{{ gameStatistics.game_summary?.total_rounds || 'N/A' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Doba hry:</span>
            <span class="value">{{ gameStatistics.game_summary?.game_duration_minutes || 'N/A' }} minut</span>
          </div>
          <div class="summary-item">
            <span class="label">Poƒçet t√Ωm≈Ø:</span>
            <span class="value">{{ gameStatistics.boards?.length || 0 }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Charts -->
    <div class="charts-section">
      <h3>üìä Grafy v√Ωkonnosti</h3>
      
      <div class="charts-grid">
        <!-- Team Performance Radar Chart -->
        <div class="chart-container">
          <h4>Porovn√°n√≠ v√Ωkonu t√Ωm≈Ø</h4>
          <canvas baseChart
                  [data]="radarChartData"
                  [labels]="radarChartLabels"
                  [options]="radarChartOptions"
                  [type]="radarChartType">
          </canvas>
        </div>

        <!-- Energy Balance Bar Chart -->
        <div class="chart-container">
          <h4>Energetick√° bilance t√Ωm≈Ø</h4>
          <canvas baseChart
                  [data]="barChartData"
                  [labels]="barChartLabels"
                  [options]="barChartOptions"
                  [type]="barChartType">
          </canvas>
        </div>

        <!-- Performance Metrics Comparison -->
        <div class="chart-container">
          <h4>Srovn√°n√≠ metrik v√Ωkonu</h4>
          <canvas baseChart
                  [data]="lineChartData"
                  [labels]="lineChartLabels"
                  [options]="lineChartOptions"
                  [type]="lineChartType">
          </canvas>
        </div>

        <!-- Overall Score Distribution -->
        <div class="chart-container">
          <h4>Celkov√© sk√≥re t√Ωm≈Ø</h4>
          <canvas baseChart
                  [data]="doughnutChartData"
                  [labels]="doughnutChartLabels"
                  [options]="doughnutChartOptions"
                  [type]="doughnutChartType">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Team Results -->
    <div class="teams-results">
      <h3>üéØ V√Ωsledky t√Ωm≈Ø</h3>
      
      <div class="teams-grid">
        <div *ngFor="let teamData of getTeamsArray(); trackBy: trackByTeam" 
             class="team-card" 
             [class.inactive]="teamData.board.total_energy_produced === 0">
          
          <!-- Team Header -->
          <div class="team-header">
            <h4>{{ teamData.board.display_name }}</h4>
            <div class="team-id">{{ teamData.board.board_id }}</div>
            <div *ngIf="teamData.board.total_energy_produced === 0" class="inactive-badge">
              Neaktivn√≠
            </div>
          </div>

          <!-- Performance Metrics -->
          <div class="performance-metrics">
            <div class="metric">
              <span class="metric-label">üå± Ekologie</span>
              <div class="metric-bar">
                <div class="metric-fill ecology" 
                     [style.width.%]="teamData.performance.ecology"></div>
                <span class="metric-value">{{ teamData.performance.ecology.toFixed(1) }}%</span>
              </div>
            </div>

            <div class="metric">
              <span class="metric-label">‚ö° Vyv√°≈æenost</span>
              <div class="metric-bar">
                <div class="metric-fill elmix" 
                     [style.width.%]="teamData.performance.elmix"></div>
                <span class="metric-value">{{ teamData.performance.elmix.toFixed(1) }}%</span>
              </div>
            </div>

            <div class="metric">
              <span class="metric-label">üí∞ Finance</span>
              <div class="metric-bar">
                <div class="metric-fill finances" 
                     [style.width.%]="teamData.performance.finances"></div>
                <span class="metric-value">{{ teamData.performance.finances.toFixed(1) }}%</span>
              </div>
            </div>

            <div class="metric">
              <span class="metric-label">üë• Popularita</span>
              <div class="metric-bar">
                <div class="metric-fill popularity" 
                     [style.width.%]="teamData.performance.popularity"></div>
                <span class="metric-value">{{ teamData.performance.popularity.toFixed(1) }}%</span>
              </div>
            </div>
          </div>

          <!-- Energy Summary -->
          <div class="energy-summary">
            <div class="energy-item">
              <span class="energy-label">Celkov√° produkce:</span>
              <span class="energy-value">{{ teamData.board.total_energy_produced.toFixed(0) }} MW</span>
            </div>
            <div class="energy-item">
              <span class="energy-label">Celkov√° spot≈ôeba:</span>
              <span class="energy-value">{{ teamData.board.total_energy_consumed.toFixed(0) }} MW</span>
            </div>
            <div class="energy-item" [class.negative]="teamData.board.energy_balance < 0">
              <span class="energy-label">Energetick√° bilance:</span>
              <span class="energy-value">{{ teamData.board.energy_balance.toFixed(0) }} MW</span>
            </div>
          </div>

          <!-- Production by Type (if available) -->
          <div *ngIf="teamData.board.average_production_by_type && getProductionTypesArray(teamData.board.average_production_by_type).length > 0" 
               class="production-by-type">
            <h5>Pr≈Ømƒõrn√° produkce podle typu:</h5>
            <div class="production-types">
              <div *ngFor="let prodType of getProductionTypesArray(teamData.board.average_production_by_type)" 
                   class="production-type-item">
                <span class="type-name">{{ prodType.name }}:</span>
                <span class="type-value">{{ prodType.value.toFixed(1) }} MW</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rankings -->
    <div class="rankings-section">
      <h3>üèÜ ≈Ωeb≈ô√≠ƒçky</h3>
      
      <div class="rankings-grid">
        <!-- Ecology Ranking -->
        <div class="ranking-category">
          <h4>üå± Nejlep≈°√≠ ekologie</h4>
          <div class="ranking-list">
            <div *ngFor="let team of getTeamsSortedBy('ecology'); let i = index" 
                 class="ranking-item" 
                 [class.first]="i === 0" 
                 [class.second]="i === 1" 
                 [class.third]="i === 2">
              <span class="rank">{{ i + 1 }}.</span>
              <span class="team-name">{{ team.board.display_name }}</span>
              <span class="score">{{ team.performance.ecology.toFixed(1) }}%</span>
            </div>
          </div>
        </div>

        <!-- ElMix Ranking -->
        <div class="ranking-category">
          <h4>‚ö° Nejlep≈°√≠ energetick√Ω mix</h4>
          <div class="ranking-list">
            <div *ngFor="let team of getTeamsSortedBy('elmix'); let i = index" 
                 class="ranking-item" 
                 [class.first]="i === 0" 
                 [class.second]="i === 1" 
                 [class.third]="i === 2">
              <span class="rank">{{ i + 1 }}.</span>
              <span class="team-name">{{ team.board.display_name }}</span>
              <span class="score">{{ team.performance.elmix.toFixed(1) }}%</span>
            </div>
          </div>
        </div>

        <!-- Finances Ranking -->
        <div class="ranking-category">
          <h4>üí∞ Nejlep≈°√≠ finance</h4>
          <div class="ranking-list">
            <div *ngFor="let team of getTeamsSortedBy('finances'); let i = index" 
                 class="ranking-item" 
                 [class.first]="i === 0" 
                 [class.second]="i === 1" 
                 [class.third]="i === 2">
              <span class="rank">{{ i + 1 }}.</span>
              <span class="team-name">{{ team.board.display_name }}</span>
              <span class="score">{{ team.performance.finances.toFixed(1) }}%</span>
            </div>
          </div>
        </div>

        <!-- Popularity Ranking -->
        <div class="ranking-category">
          <h4>üë• Nejlep≈°√≠ popularita</h4>
          <div class="ranking-list">
            <div *ngFor="let team of getTeamsSortedBy('popularity'); let i = index" 
                 class="ranking-item" 
                 [class.first]="i === 0" 
                 [class.second]="i === 1" 
                 [class.third]="i === 2">
              <span class="rank">{{ i + 1 }}.</span>
              <span class="team-name">{{ team.board.display_name }}</span>
              <span class="score">{{ team.performance.popularity.toFixed(1) }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Continue Button -->
    <div class="continue-section">
      <div class="navigation-help">
        <p>üí° Pou≈æijte kl√°vesy ‚Üê ‚Üí nebo tlaƒç√≠tka pro navigaci</p>
      </div>
      <div class="action-buttons">
        <button (click)="goBackToDashboard()" class="nav-button secondary">
          ‚Üê Zpƒõt na dashboard
        </button>
        <button (click)="onContinue()" class="continue-button primary">
          Pokraƒçovat do nastaven√≠ ‚Üí
        </button>
      </div>
    </div>
  </div>

  <!-- No Data State -->
  <div *ngIf="!isLoading && !error && !gameStatistics" class="no-data-container">
    <h2>üìä ≈Ω√°dn√° data</h2>
    <p>Nejsou k dispozici ≈æ√°dn√© statistiky hry.</p>
    <button (click)="onContinue()" class="continue-button">
      Zpƒõt do nastaven√≠
    </button>
  </div>
</div>
