<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Energy Game - Lecturer Dashboard</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        Welcome, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading dashboard...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="dashboard-content">
    
    <!-- Setup View - Before Game Starts -->
    <div *ngIf="currentView === 'setup'" class="setup-view">
      <div class="setup-section">
        <h2>Game Setup</h2>
        
        <!-- Connected Boards -->
        <div class="connected-boards-section">
          <h3>üì± Connected Boards</h3>
          <div class="boards-list">
            <div *ngIf="connectedBoards.length === 0" class="no-boards">
              <p>No boards connected yet. Waiting for ESP32 boards to connect...</p>
            </div>
            <div *ngFor="let board of connectedBoards" class="board-item">
              <span class="board-id">Board {{ board.board_id }}</span>
              <span class="board-status" [class.online]="board.last_updated">
                {{ board.last_updated ? 'Online' : 'Offline' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Scenario Selection -->
        <div class="scenario-section">
          <h3>üìã Scenario Selection</h3>
          <div class="scenario-controls">
            <select [(ngModel)]="selectedScenario" class="scenario-select">
              <option value="" disabled>Select a scenario...</option>
              <option *ngFor="let scenario of scenarios" [value]="scenario.id">
                {{ scenario.name }}
              </option>
            </select>
            <button 
              class="btn btn-start" 
              (click)="startGame()" 
              [disabled]="!selectedScenario || isGameLoading">
              {{ isGameLoading ? 'Starting...' : 'Start Game' }}
            </button>
          </div>
        </div>

        <!-- Game Status -->
        <div *ngIf="gameStatus" class="game-status">
          <h3>üéÆ Game Status</h3>
          <p><strong>Status:</strong> {{ gameStatus.game_active ? 'Active' : 'Inactive' }}</p>
          <p><strong>Current Round:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
          <p><strong>Connected Boards:</strong> {{ connectedBoards.length }}</p>
        </div>
      </div>
    </div>

    <!-- Presentation View - For Slides -->
    <div *ngIf="currentView === 'presentation'" class="presentation-view">
      <div class="presentation-header">
        <h2>üìñ Presentation Mode</h2>
        <div class="presentation-controls">
          <button class="btn btn-next" (click)="nextRound()" [disabled]="isGameLoading">
            {{ isGameLoading ? 'Loading...' : 'Next Round' }}
          </button>
          <button class="btn btn-end" (click)="endGame()" [disabled]="isGameLoading">
            End Game
          </button>
        </div>
      </div>

      <!-- PDF Viewer -->
      <div class="pdf-container" *ngIf="pdfUrl">
        <iframe [src]="pdfUrl" class="pdf-viewer" frameborder="0">
          <p>Your browser does not support PDFs. 
             <a [href]="pdfUrl" target="_blank">Download the PDF</a>
          </p>
        </iframe>
      </div>

      <!-- Slide Information -->
      <div *ngIf="currentRound && currentRound.slide_range" class="slide-info">
        <h3>Current Slides</h3>
        <p>Showing slides {{ currentRound.slide_range.start }} - {{ currentRound.slide_range.end }}</p>
      </div>
    </div>

    <!-- Game View - For Day/Night Rounds -->
    <div *ngIf="currentView === 'game'" class="game-view">
      <div class="game-header">
        <h2>‚ö° Game Board - {{ currentRound?.round_type?.toUpperCase() }} Round</h2>
        <div class="game-controls">
          <button class="btn btn-next" (click)="nextRound()" [disabled]="isGameLoading">
            {{ isGameLoading ? 'Loading...' : 'Next Round' }}
          </button>
          <button class="btn btn-end" (click)="endGame()" [disabled]="isGameLoading">
            End Game
          </button>
        </div>
      </div>

      <!-- Round Information -->
      <div *ngIf="currentRound" class="round-info">
        <h3>Round {{ currentRound.round }} - {{ currentRound.round_type.toUpperCase() }}</h3>
        
        <!-- Game Data -->
        <div *ngIf="currentRound.game_data" class="game-data">
          <div class="data-section">
            <h4>üîã Production Coefficients</h4>
            <div class="data-grid">
              <div *ngFor="let item of objectKeys(currentRound.game_data.production_coefficients)" class="data-item">
                <span class="data-label">{{ item }}:</span>
                <span class="data-value">{{ currentRound.game_data.production_coefficients[item] }} MW</span>
              </div>
            </div>
          </div>
          
          <div class="data-section">
            <h4>üè¢ Consumption Modifiers</h4>
            <div class="data-grid">
              <div *ngFor="let item of objectKeys(currentRound.game_data.consumption_modifiers)" class="data-item">
                <span class="data-label">{{ item }}:</span>
                <span class="data-value">{{ currentRound.game_data.consumption_modifiers[item] }} MW</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Connected Boards Real-time Data -->
      <div class="boards-realtime">
        <h3>üìä Board Data (Real-time)</h3>
        <div class="boards-grid">
          <div *ngFor="let board of connectedBoards" class="board-card">
            <div class="board-header">
              <h4>Board {{ board.board_id }}</h4>
              <span class="board-status" [class.online]="board.last_updated">
                {{ board.last_updated ? 'Online' : 'Offline' }}
              </span>
            </div>
            <div class="board-data">
              <div class="power-info">
                <div class="power-item production">
                  <span class="power-label">Production:</span>
                  <span class="power-value">{{ board.current_production || 0 | number:'1.1-1' }} W</span>
                </div>
                <div class="power-item consumption">
                  <span class="power-label">Consumption:</span>
                  <span class="power-value">{{ board.current_consumption || 0 | number:'1.1-1' }} W</span>
                </div>
              </div>
              <div class="connections">
                <p><strong>Connected Production:</strong> {{ board.connected_production?.length || 0 }} units</p>
                <p><strong>Connected Consumption:</strong> {{ board.connected_consumption?.length || 0 }} units</p>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="connectedBoards.length === 0" class="no-boards">
          <p>No boards connected or sending data.</p>
        </div>
      </div>
    </div>
  </div>
</div>
