<div class="dashboard-container" [class.fullscreen]="isFullscreen">
  <!-- Header -->
  <div *ngIf="currentView !== 'presentation' && !isFullscreen" class="dashboard-header">
    <h1>Energetick√° hra - Dashboard lektora</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        V√≠tejte, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Odhl√°sit se</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Naƒç√≠t√°n√≠ dashboard...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="dashboard-content">
    
    <!-- Presentation View - For Slides -->
    <div *ngIf="currentView === 'presentation'" class="presentation-view">
      <!-- Slide Presentation Component -->
      <div class="slide-presentation-wrapper">
        <app-slide-presentation 
          [currentRound]="currentRound"
          [currentRoundDetails]="currentRoundDetails"
          [externalFullscreen]="isFullscreen"
          [gameStatus]="gameStatus"
          (advanceToNextRound)="nextRound()"
          (toggleFullscreenRequest)="toggleFullscreen()"
          (scenarioFinished)="scenarioFinishedHandler()">
        </app-slide-presentation>

        <!-- End-of-Scenario Confirmation Overlay -->
        <div class="end-of-scenario-overlay" *ngIf="gameFinished && (!gameStatus?.game_active)">
          <div class="end-dialog">
            <h2>Sc√©n√°≈ô dokonƒçen</h2>
            <p>V≈°echny kola byla odehr√°na. Chcete zobrazit statistiky nebo se vr√°tit na v√Ωbƒõr sc√©n√°≈ôe?</p>
            <div class="end-actions">
              <button class="end-btn primary" (click)="navigateToStatistics()">üìä Zobrazit statistiky</button>
              <button class="end-btn" (click)="onContinueFromStatistics()">‚Ü©Ô∏è N√°vrat na sc√©n√°≈ôe</button>
            </div>
            <small>Statistiky jsou dostupn√© tak√© pozdƒõji na str√°nce v√Ωbƒõru sc√©n√°≈ôe.</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Game View - For Day/Night Rounds -->
    <div *ngIf="currentView === 'game'" class="game-view">
      <!-- New Game Layout: Left - Middle - Right -->
      <div class="game-layout">
        <!-- Left Side - Boards -->
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards()" class="board-card" [class.placeholder]="isBoardPlaceholder(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Middle - Weather and Special Effects -->
        <div class="weather-info">
          <!-- Weather Box (Top) -->
          <div class="weather-box" [style.background-image]="weatherBoxBackground">
            <div class="weather-box-content">
              <!-- Left Column - Weather Icon -->
              <div class="weather-icon-column">
                <div class="weather-main-icon" [innerHTML]="weatherMainIcon"></div>
              </div>
              
              <!-- Right Column - Weather Info -->
              <div class="weather-info-column">
                <!-- Temperature Row -->
                <div class="weather-temperature">{{ weatherTemperature }}</div>
                
                <!-- Weather Type Row -->
                <div class="weather-type">{{ weatherTypeName }}</div>
                
                <!-- Wind Row (Optional) -->
                <div class="weather-wind" *ngIf="windInfo">
                  <div class="wind-icon" [innerHTML]="windIcon"></div>
                  <div class="wind-speed">{{ windSpeed }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Special Effects Box (Bottom) -->
          <div *ngIf="specialEffects.length > 0" class="special-effects-box">
            <h4>Speci√°ln√≠ efekty:</h4>
            <ul class="effects-list">
              <li *ngFor="let effect of specialEffects" class="effect-item">
                <div class="effect-icon">
                  <img *ngIf="effect.icon_url" [src]="effect.icon_url" alt="Effect icon">
                  <span *ngIf="!effect.icon_url" [innerHTML]="effect.icon"></span>
                </div>
                <span class="effect-text">{{ effect.text }}</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Right Side - Boards -->
        <div class="boards-right">
          <div *ngFor="let board of getRightBoards()" class="board-card" [class.placeholder]="isBoardPlaceholder(board)">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Fullscreen Control -->
  <div class="floating-fullscreen-controls" *ngIf="currentView === 'game' || currentView === 'presentation'">
    <button 
      class="floating-fullscreen-btn" 
      (click)="toggleFullscreen()"
      [title]="isFullscreen ? 'Ukonƒçit celou obrazovku (F nebo ESC)' : 'Cel√° obrazovka (F)'">
      {{ isFullscreen ? 'üóó' : '‚õ∂' }}
    </button>
  </div>
</div>
