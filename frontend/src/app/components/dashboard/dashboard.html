<div class="dashboard-container" [class.fullscreen]="isFullscreen">
  <!-- Header -->
  <div *ngIf="currentView !== 'game' && currentView !== 'presentation' && !isFullscreen" class="dashboard-header">
    <h1>Energy Game - Lecturer Dashboard</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        Welcome, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading dashboard...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="dashboard-content">
    
    <!-- Setup View - Before Game Starts -->
    <div *ngIf="currentView === 'setup'" class="setup-view">
      <div class="setup-section">
        <h2>Game Setup</h2>
        
        <!-- Scenario Selection -->
        <div class="scenario-section">
          <h3>Scenario Selection</h3>
          <div class="scenario-controls">
            <select [(ngModel)]="selectedScenario" class="scenario-select">
              <option value="" disabled>Select a scenario...</option>
              <option *ngFor="let scenario of scenarios" [value]="scenario.id">
                {{ scenario.name }}
              </option>
            </select>
            <button 
              class="btn btn-start" 
              (click)="startGame()" 
              [disabled]="!selectedScenario || isGameLoading">
              {{ isGameLoading ? 'Starting...' : 'Start Game' }}
            </button>
          </div>
        </div>

        <!-- Keyboard Shortcuts Information -->
        <div class="keyboard-shortcuts-section">
          <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
          <div class="shortcuts-grid">
            <div class="shortcut-item">
              <span class="shortcut-key">Q</span>
              <span class="shortcut-description">End Game (with confirmation)</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">L</span>
              <span class="shortcut-description">Logout (with confirmation)</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">‚Üí</span>
              <span class="shortcut-description">Next Round (during game)</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">F</span>
              <span class="shortcut-description">Toggle Fullscreen</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">ESC</span>
              <span class="shortcut-description">Exit Fullscreen</span>
            </div>
          </div>
          <p class="shortcuts-note">* Shortcuts are active during game and presentation views</p>
        </div>

        <!-- Connected Boards in New Layout -->
        <div class="boards-container setup-horizontal">
          <div class="boards-left">
            <div *ngFor="let board of getLeftBoards(); let i = index" class="board-card" [class.placeholder]="board.is_placeholder">
              <div class="board-header">
                <h4>{{ getTeamDisplayName(board) }}</h4>
                <div class="board-indicators">
                  <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
                </div>
              </div>
              <div class="board-data">
                <div class="power-line">
                  <span class="power-label">V√Ωroba:</span>
                  <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
                </div>
                <div class="power-line">
                  <span class="power-label">Spot≈ôeba:</span>
                  <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
                </div>
              </div>
            </div>
          </div>

          <div class="boards-right">
            <div *ngFor="let board of getRightBoards(); let i = index" class="board-card" [class.placeholder]="board.is_placeholder">
              <div class="board-header">
                <h4>{{ getTeamDisplayName(board) }}</h4>
                <div class="board-indicators">
                  <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
                </div>
              </div>
              <div class="board-data">
                <div class="power-line">
                  <span class="power-label">V√Ωroba:</span>
                  <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
                </div>
                <div class="power-line">
                  <span class="power-label">Spot≈ôeba:</span>
                  <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Game Status -->
        <div *ngIf="gameStatus" class="game-status">
          <h3>üéÆ Game Status</h3>
          <p><strong>Status:</strong> {{ gameStatus.game_active ? 'Active' : 'Inactive' }}</p>
          <p><strong>Current Round:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
          <p><strong>Connected Boards:</strong> {{ connectedBoards.length }}</p>
        </div>
      </div>
    </div>

    <!-- Presentation View - For Slides -->
    <div *ngIf="currentView === 'presentation'" class="presentation-view">
      <!-- Slide Presentation Component -->
      <div class="slide-presentation-wrapper">
        <app-slide-presentation 
          [currentRound]="currentRound"
          [currentRoundDetails]="currentRoundDetails"
          [externalFullscreen]="isFullscreen"
          (advanceToNextRound)="nextRound()"
          (toggleFullscreenRequest)="toggleFullscreen()">
        </app-slide-presentation>
      </div>
    </div>

    <!-- Game View - For Day/Night Rounds -->
    <div *ngIf="currentView === 'game'" class="game-view">
      <!-- New Game Layout: Left - Middle - Right -->
      <div class="game-layout">
        <!-- Left Side - Boards -->
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards()" class="board-card" [class.placeholder]="board.is_placeholder">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Middle - Weather and Special Effects -->
        <div class="weather-info">
          <!-- Weather Box (Top) -->
          <div class="weather-box" [style.background-image]="weatherBoxBackground">
            <div class="weather-box-content">
              <!-- Left Column - Weather Icon -->
              <div class="weather-icon-column">
                <div class="weather-main-icon" [innerHTML]="weatherMainIcon"></div>
              </div>
              
              <!-- Right Column - Weather Info -->
              <div class="weather-info-column">
                <!-- Temperature Row -->
                <div class="weather-temperature">{{ weatherTemperature }}</div>
                
                <!-- Weather Type Row -->
                <div class="weather-type">{{ weatherTypeName }}</div>
                
                <!-- Wind Row (Optional) -->
                <div class="weather-wind" *ngIf="windInfo">
                  <div class="wind-icon" [innerHTML]="windIcon"></div>
                  <div class="wind-speed">{{ windSpeed }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Special Effects Box (Bottom) -->
          <div *ngIf="specialEffects.length > 0" class="special-effects-box">
            <h4>Speci√°ln√≠ efekty:</h4>
            <ul class="effects-list">
              <li *ngFor="let effect of specialEffects" class="effect-item">
                <div class="effect-icon">
                  <img *ngIf="effect.icon_url" [src]="effect.icon_url" alt="Effect icon">
                  <span *ngIf="!effect.icon_url" [innerHTML]="effect.icon"></span>
                </div>
                <span class="effect-text">{{ effect.text }}</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Right Side - Boards -->
        <div class="boards-right">
          <div *ngFor="let board of getRightBoards()" class="board-card" [class.placeholder]="board.is_placeholder">
            <div class="board-header">
              <h4>{{ getTeamDisplayName(board) }}</h4>
              <div class="board-indicators">
                <span class="grid-status" [innerHTML]="getGridStatusIcon(board)"></span>
              </div>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MW</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MW</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Fullscreen Control -->
  <div class="floating-fullscreen-controls" *ngIf="currentView === 'game' || currentView === 'presentation'">
    <button 
      class="floating-fullscreen-btn" 
      (click)="toggleFullscreen()"
      [title]="isFullscreen ? 'Exit Fullscreen (F or ESC)' : 'Enter Fullscreen (F)'">
      {{ isFullscreen ? 'üóó' : '‚õ∂' }}
    </button>
  </div>
</div>
