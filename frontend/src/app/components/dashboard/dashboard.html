<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Energy Game - Lecturer Dashboard</h1>
    <div class="header-controls">
      <span *ngIf="userInfo" class="user-info">
        Welcome, {{ userInfo.username }}! ({{ userInfo.user_type }})
      </span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading dashboard...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && userInfo" class="dashboard-content">
    
    <!-- Setup View - Before Game Starts -->
    <div *ngIf="currentView === 'setup'" class="setup-view">
      <div class="setup-section">
        <h2>Game Setup</h2>
        
        <!-- Scenario Selection -->
        <div class="scenario-section">
          <h3>ÔøΩ Scenario Selection</h3>
          <div class="scenario-controls">
            <select [(ngModel)]="selectedScenario" class="scenario-select">
              <option value="" disabled>Select a scenario...</option>
              <option *ngFor="let scenario of scenarios" [value]="scenario.id">
                {{ scenario.name }}
              </option>
            </select>
            <button 
              class="btn btn-start" 
              (click)="startGame()" 
              [disabled]="!selectedScenario || isGameLoading">
              {{ isGameLoading ? 'Starting...' : 'Start Game' }}
            </button>
          </div>
        </div>

        <!-- Connected Boards in New Layout -->
        <div class="boards-container">
          <div class="boards-left">
            <div *ngFor="let board of getLeftBoards()" class="board-card">
              <div class="board-header">
                <h4>T√Ωm #{{ board.board_id }}</h4>
                <span class="board-status" [class.online]="board.last_updated" [class.offline]="!board.last_updated">
                  {{ board.last_updated ? '‚óè' : '‚óè' }}
                </span>
              </div>
              <div class="board-data">
                <div class="power-line">
                  <span class="power-label">V√Ωroba:</span>
                  <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MWh</span>
                </div>
                <div class="power-line">
                  <span class="power-label">Spot≈ôeba:</span>
                  <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MWh</span>
                </div>
              </div>
            </div>
          </div>

          <div class="boards-right">
            <div *ngFor="let board of getRightBoards()" class="board-card">
              <div class="board-header">
                <h4>T√Ωm #{{ board.board_id }}</h4>
                <span class="board-status" [class.online]="board.last_updated" [class.offline]="!board.last_updated">
                  {{ board.last_updated ? '‚óè' : '‚óè' }}
                </span>
              </div>
              <div class="board-data">
                <div class="power-line">
                  <span class="power-label">V√Ωroba:</span>
                  <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MWh</span>
                </div>
                <div class="power-line">
                  <span class="power-label">Spot≈ôeba:</span>
                  <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MWh</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Game Status -->
        <div *ngIf="gameStatus" class="game-status">
          <h3>üéÆ Game Status</h3>
          <p><strong>Status:</strong> {{ gameStatus.game_active ? 'Active' : 'Inactive' }}</p>
          <p><strong>Current Round:</strong> {{ gameStatus.current_round }} / {{ gameStatus.total_rounds }}</p>
          <p><strong>Connected Boards:</strong> {{ connectedBoards.length }}</p>
        </div>
      </div>
    </div>

    <!-- Presentation View - For Slides -->
    <div *ngIf="currentView === 'presentation'" class="presentation-view">
      <div class="presentation-header">
        <h2>üìñ Presentation Mode</h2>
        <div class="presentation-controls">
          <button class="btn btn-next" (click)="nextRound()" [disabled]="isGameLoading">
            {{ isGameLoading ? 'Loading...' : 'Next Round' }}
          </button>
          <button class="btn btn-end" (click)="endGame()" [disabled]="isGameLoading">
            End Game
          </button>
        </div>
      </div>

      <!-- Slide Presentation Component -->
      <div class="slide-presentation-wrapper">
        <app-slide-presentation 
          [currentRound]="currentRound"
          [currentRoundDetails]="currentRoundDetails"
          (advanceToNextRound)="nextRound()">
        </app-slide-presentation>
      </div>
    </div>

    <!-- Game View - For Day/Night Rounds -->
    <div *ngIf="currentView === 'game'" class="game-view">
      <div class="game-header">
        <h2>‚ö° Game Board</h2>
        <div class="game-controls">
          <button class="btn btn-next" (click)="nextRound()" [disabled]="isGameLoading">
            {{ isGameLoading ? 'Loading...' : 'Next Round' }}
          </button>
          <button class="btn btn-end" (click)="endGame()" [disabled]="isGameLoading">
            End Game
          </button>
        </div>
      </div>

      <!-- New Game Layout: Left - Middle - Right -->
      <div class="game-layout">
        <!-- Left Side - Boards -->
        <div class="boards-left">
          <div *ngFor="let board of getLeftBoards()" class="board-card">
            <div class="board-header">
              <h4>T√Ωm #{{ board.board_id }}</h4>
              <span class="board-status" [class.online]="board.last_updated" [class.offline]="!board.last_updated">
                {{ board.last_updated ? '‚óè' : '‚óè' }}
              </span>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MWh</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MWh</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Middle - Weather and Special Effects -->
        <div class="weather-info">
          <div class="weather-box">
            <!-- Round Type and Weather -->
            <div class="round-weather">
              <div class="round-type">
                <span class="round-icon" [innerHTML]="getRoundIcon()"></span>
                <span class="round-name">{{ getRoundName() }}</span>
              </div>
              
              <div *ngIf="getWeatherInfo()" class="weather-conditions">
                <div class="temperature">{{ getTemperature() }}</div>
                <div class="weather-name">{{ getWeatherName() }}</div>
              </div>
            </div>

            <!-- Special Effects -->
            <div *ngIf="getSpecialEffects().length > 0" class="special-effects">
              <div *ngFor="let effect of getSpecialEffects()" class="effect-item">
                <span class="effect-icon" [innerHTML]="effect.icon"></span>
                <span class="effect-text">{{ effect.text }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Side - Boards -->
        <div class="boards-right">
          <div *ngFor="let board of getRightBoards()" class="board-card">
            <div class="board-header">
              <h4>T√Ωm #{{ board.board_id }}</h4>
              <span class="board-status" [class.online]="board.last_updated" [class.offline]="!board.last_updated">
                {{ board.last_updated ? '‚óè' : '‚óè' }}
              </span>
            </div>
            <div class="board-data">
              <div class="power-line">
                <span class="power-label">V√Ωroba:</span>
                <span class="power-value">{{ board.production || 0 | number:'1.0-0' }} MWh</span>
              </div>
              <div class="power-line">
                <span class="power-label">Spot≈ôeba:</span>
                <span class="power-value">{{ board.consumption || 0 | number:'1.0-0' }} MWh</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
